<?xml version="1.0" encoding="UTF-8"?>
<sequence name="MainSequence" onError="FaultSequence" trace="disable" xmlns="http://ws.apache.org/ns/synapse">
    <property name="OUT_ONLY" scope="default" type="STRING" value="true"/>
    <transaction action="new"/>
    <dbreport useTransaction="true">
        <connection>
            <pool>
                <dsName>ORDERS_DS</dsName>
            </pool>
        </connection>
        <statement>
            <sql><![CDATA[INSERT INTO orders (item_id, item_units, customer_id) values (?,?,?)]]></sql>
            <parameter expression="//order/itemId" type="INTEGER"/>
            <parameter expression="//order/itemUnits" type="INTEGER"/>
            <parameter expression="//order/customerId" type="INTEGER"/>
        </statement>
    </dbreport>
    <callout serviceURL="jms:/out?transport.jms.ConnectionFactoryJNDIName=XAConnectionFactory&amp;java.naming.factory.initial=org.apache.activemq.jndi.ActiveMQInitialContextFactory&amp;java.naming.provider.url=tcp://localhost:61616&amp;transport.jms.DestinationType=queue">
        <source type="envelope"/>
        <target xpath="/"/>
    </callout>
    <script description="Execute the failing script" language="nashornJs"><![CDATA[throw new java.lang.Exception("This is the reason why the processing has failed");]]></script>
    <transaction action="commit"/>
    <drop/>
</sequence>